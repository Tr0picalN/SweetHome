<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link type="text/css" rel="stylesheet" href="../css/bootstrap.min.css" />
  <link type="text/css" rel="stylesheet" href="../css/bootstrap-vue.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
  <div id="app">
    <b-container>
      <b-row class="vh-100" align-v="center" align-h="center">
        <b-col style="max-width: 400px;">
          <b-card>
              <b-row class="vh-100 text-center" style="max-height: 500px;" cols="2" align-v="center" align-h="center">
                <b-col v-for="(state, index) in states" :state="state" :index="index">
                  <b-button variant="outline-light" @click="onClick(index)" :key="state.id">
                    <b-icon icon="power" font-scale="4" :variant="state ? 'success' : 'danger'"></b-icon>
                  </b-button>
                </b-col>
              </b-row>
              <div class="text-right">
                <b-button variant="link"><b-icon icon="gear-fill" /></b-button>
              </div>
          </b-card>
        </b-col>
      </b-row>
    </b-container>
  </div>

  <script src="../script/vue.min.js"></script>
  <script src="../script/bootstrap-vue.min.js"></script>
  <script src="../script/bootstrap-vue-icons.min.js"></script>
  <script src="../script/axios.min.js"></script>
  <script>
    new Vue({
      el: '#app',

      created () {
        this.onScan()
        
        this.polling = setInterval(() => {
          this.onScan()
        }, 500)
      },

      beforeDestroy () {
        clearInterval(this.polling)
      },

      data: () => ({
<<<<<<< HEAD
=======
        polling: null,
>>>>>>> 2fa76fc84998b88078626ab2b60af4bd445ba09a
        states: []
      }),

      methods: {
        onReset () {
          axios.get('/reset')
          .then(res => {

          })
          .catch(err => {
            
          })
        },

        onClick(index) {
          axios.get('/action', {
            params: {
              switch: index
            }
          })
          .then(res => {
            this.states = res.data.states
          })
          .catch(err => {
            console.log(err)
          })
        },

        onScan() {
          axios.get('/state')
            .then(res => {
              this.states = res.data.states
            })
            .catch(err => {
              console.log(err)
            })
        },
      }
    })
  </script>
</body>
</html>